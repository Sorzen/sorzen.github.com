<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Sorzen,owengengshaozhen@live.com"><title>socket.io 简介及使用 · Sorzen</title><meta name="description" content="socket.io 简介socket.io 是一个为实时应用提供跨平台实时通信的库。socket.io 旨在使实时应用在每个浏览器和移动设备上成为可能，模糊不同的传输机制之间的差异。
socket.io 的名字源于它使用了浏览器支持并采用的 HTML5 WebSocket 标准，因为并不是所有的浏览"><meta name="keywords" content="HTML,CSS,JavaScript,Vue"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Sorzen</a></h3><div class="description"><p>记录个人学习感受和学习笔记！  --Sorzen</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/2941002937/profile?rightmod=1&amp;wvr=6&amp;mod=personnumber&amp;is_all=1"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/Sorzen"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about/resume.html">简历</a></li><li><a href="/archives">归档</a></li><li><a href="https://github.com/Sorzen">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"></a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>socket.io 简介及使用</a></h3></div><div class="post-content"><h2 id="socket-io-简介"><a href="#socket-io-简介" class="headerlink" title="socket.io 简介"></a>socket.io 简介</h2><p>socket.io 是一个为实时应用提供跨平台实时通信的库。socket.io 旨在使实时应用在每个浏览器和移动设备上成为可能，模糊不同的传输机制之间的差异。</p>
<p>socket.io 的名字源于它使用了浏览器支持并采用的 HTML5 WebSocket 标准，因为并不是所有的浏览器都支持 WebSocket ，所以该库支持一系列降级功能。</p>
<ul>
<li>Websocket</li>
<li>Adobe® Flash® Socket</li>
<li>AJAX long polling</li>
<li>AJAX multipart streaming</li>
<li>Forever Iframe</li>
<li>JSONP Polling</li>
</ul>
<h2 id="socket-io-使用"><a href="#socket-io-使用" class="headerlink" title="socket.io 使用"></a>socket.io 使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install socket.io</div></pre></td></tr></table></figure>
<p>若使用 express ，则在 package.json 中的 dependencies 添加 “socket.io”: “*” 并 npm install 即可。<br>以使用 Express 3.x 为例，官方例子如下：</p>
<h4 id="CLIENT-INDEX-HTML"><a href="#CLIENT-INDEX-HTML" class="headerlink" title="CLIENT (INDEX.HTML)"></a>CLIENT (INDEX.HTML)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script&gt;</div><div class="line">  var socket = io.connect(&apos;http://localhost&apos;);</div><div class="line">  socket.on(&apos;news&apos;, function (data) &#123;</div><div class="line">    console.log(data);</div><div class="line">    socket.emit(&apos;my other event&apos;, &#123; my: &apos;data&apos; &#125;);</div><div class="line">  &#125;);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>客户端（这里是浏览器）通过引入 <script src="/socket.io/socket.io.js"></script> 即可使用 socket.io 。  var socket = io.connect(‘<a href="http://localhost" target="_blank" rel="external">http://localhost</a>‘); 与 <a href="http://localhost" target="_blank" rel="external">http://localhost</a> 本地服务器建立连接并赋值给 socket 对象，如果是与其他服务器建立连接则只需将 connect() 参数修改为服务器的地址即可，这里 socket.io 客户端和服务器位于同一个服务器上，那么也可以简写为 var socket = io.connect();</p>
<h4 id="SERVER-APP-JS"><a href="#SERVER-APP-JS" class="headerlink" title="SERVER (APP.JS)"></a>SERVER (APP.JS)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">var app = require(&apos;express&apos;)()</div><div class="line">  , server = require(&apos;http&apos;).createServer(app)</div><div class="line">  , io = require(&apos;socket.io&apos;).listen(server);</div><div class="line"></div><div class="line">server.listen(80);</div><div class="line"></div><div class="line">app.get(&apos;/&apos;, function (req, res) &#123;</div><div class="line">  res.sendfile(__dirname + &apos;/index.html&apos;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">io.sockets.on(&apos;connection&apos;, function (socket) &#123;</div><div class="line">  socket.emit(&apos;news&apos;, &#123; hello: &apos;world&apos; &#125;);</div><div class="line">  socket.on(&apos;my other event&apos;, function (data) &#123;</div><div class="line">    console.log(data);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>其中 io = require(‘socket.io’).listen(server); 将 socket.io 绑定到服务器上，于是任何连接到该服务器的客户端都具备了实时通信功能。 io.sockets.on(‘connection’, function (socket) { … }) 的作用是服务器监听所有客户端，并返回该新连接对象，接下来我们就可以通过该连接对象（socket）与客户端进行通信了。你可以看到不管是服务器还是客户端都有 emit 和 on 这两个函数，可以说 socket.io 的核心就是这两个函数了，通过 emit 和 on 可以轻松地实现服务器与客户端之间的双向通信。</p>
<ul>
<li>emit ：用来发射一个事件或者说触发一个事件，第一个参数为事件名，第二个参数为要发送的数据，第三个参数为回调函数（一般省略，如需对方接受到信息后立即得到确认时，则需要用到回调函数）。</li>
<li>on ：用来监听一个 emit 发射的事件，第一个参数为要监听的事件名，第二个参数为一个匿名函数用来接收对方发来的数据，该匿名函数的第一个参数为接收的数据，若有第二个参数，则为要返回的函数。</li>
</ul>
<p>socket.io 提供了三种默认的事件（客户端和服务器都有）：connect 、message 、disconnect 。当与对方建立连接后自动触发 connect 事件，当收到对方发来的数据后触发 message 事件（通常为 socket.send() 触发），当对方关闭连接后触发 disconnect 事件。</p>
<p>此外，socket.io 还支持自定义事件，毕竟以上三种事件应用范围有限，正是通过这些自定义的事件才实现了丰富多彩的通信。</p>
<p>最后，需要注意的是，在服务器端区分以下三种情况：</p>
<ul>
<li>socket.emit() ：向建立该连接的客户端广播</li>
<li>socket.broadcast.emit() ：向除去建立该连接的客户端的所有客户端广播</li>
<li>io.sockets.emit()：向所有客户端广播，等同于上面两个的和</li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-07-25</span><i class="fa fa-tag"></i><a href="/tags/websocket/" title="websocket" class="tag">websocket </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2017/07/25/socket.io 简介及使用/,Sorzen,socket.io 简介及使用,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2017/08/27/前端工程化实践：大前端的转变之路/" title="前端工程化实践：大前端的转变之路" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2017/07/24/5个事件驱动的API架构协议/" title="5个事件驱动的API架构协议" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>