<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Sorzen,owengengshaozhen@live.com"><title>开发过程采坑记录 · Sorzen</title><meta name="description" content="起因最近开发中遇到一些不太常遇到的问题，心血来潮记录一下他们产生的原因，有些问题找了很久才发现问题所在，也给需要的人一些帮助。
问题1：Form表单提交bug当form表单中只含有一个input输入框时，并且输入框获取焦点然后点击enter时会触发form表单的默认提交事件（input为textar"><meta name="keywords" content="HTML,CSS,JavaScript,Vue"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Sorzen</a></h3><div class="description"><p>记录个人学习感受和学习笔记！  --Sorzen</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/2941002937/profile?rightmod=1&amp;wvr=6&amp;mod=personnumber&amp;is_all=1"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/Sorzen"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about/resume.html">简历</a></li><li><a href="/archives">归档</a></li><li><a href="https://github.com/Sorzen">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"></a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>开发过程采坑记录</a></h3></div><div class="post-content"><h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>最近开发中遇到一些不太常遇到的问题，心血来潮记录一下他们产生的原因，有些问题找了很久才发现问题所在，也给需要的人一些帮助。</p>
<h2 id="问题1：Form表单提交bug"><a href="#问题1：Form表单提交bug" class="headerlink" title="问题1：Form表单提交bug"></a>问题1：Form表单提交bug</h2><p>当form表单中只含有一个input输入框时，并且输入框获取焦点然后点击enter时会触发form表单的默认提交事件（input为textarea时不会触发），产生的后果是页面刷新，但是当页面包含两个以上input输入框时不会触发form表单的默认提交。</p>
<h3 id="问题定位过程"><a href="#问题定位过程" class="headerlink" title="问题定位过程"></a>问题定位过程</h3><p>当发现这个现象时想到的产生这个现象原因可能是组件自身遗留问题，因为开发采用的是iview，是在使用Tag+Input组件时发现这个bug，因为Input组件使用的enter事件是经过封装之后暴露出来的事件，因此怀疑是组件自身问题，于是使用原生事件去替代，还是会触发表单默认提交动作，后经查阅才发现是form表单中有单个input框造成的原因，之后便对症下药寻找解决之法。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><h4 id="一、避免form中有单个input输入框"><a href="#一、避免form中有单个input输入框" class="headerlink" title="一、避免form中有单个input输入框"></a>一、避免form中有单个input输入框</h4><p>  当页面中无法避免使用单个input输入框时，再添加一个input框并使用v-show=”false”使其隐藏。<br>  这个方法虽然可以很简便解决问题，但是页面中无故多出一些元素，不仅代码不美观而且使代码可读性大大降低，因此不太推荐使用此方法。</p>
<h4 id="二、禁用input的enter事件"><a href="#二、禁用input的enter事件" class="headerlink" title="二、禁用input的enter事件"></a>二、禁用input的enter事件</h4><p>为防止input在form表单中无故被提交，因此最好的办法就是禁止🚫enter事件，在页面加载时即mounted()添加form表单阻止事件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 阻止表单的默认提交事件，当页面只有一个input并且focus后点击会触发form表单的默认</div><div class="line">  document.getElementsByTagName(&apos;form&apos;)[0].addEventListener(&apos;keypress&apos;, (event) =&gt; &#123;</div><div class="line">    if (event.keyCode === 13 &amp;&amp; event.target.tagName !== &apos;TEXTAREA&apos;) &#123;</div><div class="line">      event.preventDefault();</div><div class="line">    &#125;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<h4 id="三、禁用form中所有的enter事件"><a href="#三、禁用form中所有的enter事件" class="headerlink" title="三、禁用form中所有的enter事件"></a>三、禁用form中所有的enter事件</h4><p>利用事件委托原理，直接在父级元素上添加事件，即可使页面中所有input元素禁用enter事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;form @keypress.enter.native=&quot;$event.preventDefault()”&gt;&lt;/form&gt;</div></pre></td></tr></table></figure></p>
<p>缺点：<br>虽然这个方法可以解决遇到的问题，但是当页面中某些input需要enter事件，会容易形成误伤，因此推荐第二种方法进行分类解决，可以避免误伤的情况。</p>
<h2 id="问题2：vue中父组件对子组件设置v-if属性导致watch不起作用"><a href="#问题2：vue中父组件对子组件设置v-if属性导致watch不起作用" class="headerlink" title="问题2：vue中父组件对子组件设置v-if属性导致watch不起作用"></a>问题2：vue中父组件对子组件设置v-if属性导致watch不起作用</h2><h3 id="一、比如-："><a href="#一、比如-：" class="headerlink" title="一、比如 ："></a>一、比如 ：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;add-roles  v-if=&quot;flag&quot;  :id=&quot;current_id&quot; &gt;&lt;/add-roles&gt;</div></pre></td></tr></table></figure>
<p>有个函数把flag 设置为true 子组件显示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">look_role(id) &#123;</div><div class="line">  this.flag = true;</div><div class="line">  this.current_id =id;</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>子组件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">props:[&quot;id&quot;],</div><div class="line">watch:&#123;</div><div class="line"> &apos;id&apos;: function(newVal,oldVal)&#123;</div><div class="line">    console.log(&quot;sdfsadf&quot;,newVal);</div><div class="line">  &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>你会发现根本监听不到 id 的变化<br>这是因为v-if会影响子组件的生命周期导致watch不起作用</p>
<h3 id="二、原因"><a href="#二、原因" class="headerlink" title="二、原因"></a>二、原因</h3><p>我们可以从这两者区别来探讨原因：<br>v-if 是’真正的’条件渲染,因为它会确保在切换过程中条件块内的事件监听器和子组件适当地被销毁和重建.</p>
<p>v-if 也是惰性的,如果在初始渲染时条件为假,那么什么都不做，直到条件第一次为真的时候才会开始渲染条件块,<br>相比之下,v-show就简单得多，不管初始条件是什么,元素总会被渲染,并且只是简单的基于css进行切换.</p>
<p>一般来说,v-if 有更高的切换开销,而 v-show 有更高的初始渲染开销.因此,如果需要非常频繁的切换,那么使用v-show好一点;如果在<br>运行时条件不太可能改变,则使用v-if 好点.</p>
<p>因此当v-if=”false”时，页面并没有渲染此DOM元素，当设置为true时才开始渲染，因此当v-if=’true’时父组件开始渲染子组件，因此子组件不能及时watch父组件传来的值的变化。<br>当使用v-show时只是在css样式上的显示和隐藏，而DOM元素一直存在于页面中，子组件可以一直监测父组件传递来的值的变化。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-05-03</span><i class="fa fa-tag"></i><a href="/tags/踩坑-开发中遇到的bug/" title="踩坑,开发中遇到的bug" class="tag">踩坑,开发中遇到的bug </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2018/05/03/开发过程采坑/,Sorzen,开发过程采坑记录,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a role="navigation" href="/2018/03/03/js设计模式/" title="JS设计模式" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>